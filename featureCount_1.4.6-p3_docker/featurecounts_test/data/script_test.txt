# 2. Création du fichier d’annotation GTF
{
echo "##gff-version 3"
echo -e "chr1\t.\tgene\t1\t1000\t.\t+\t.\tID=geneA"
echo -e "chr1\t.\tgene\t2000\t3000\t.\t-\t.\tID=geneB"
} > annotation.gtf

# 3. Création d’un fichier SAM minimal avec tabulations
echo -e '@HD\tVN:1.0\tSO:unsorted\n@SQ\tSN:chr1\tLN:4000\nr1\t0\tchr1\t100\t255\t50M\t*\t0\t0\t*\t*\nr2\t16\tchr1\t2500\t255\t50M\t*\t0\t0\t*\t*' > toy.sam

# 4. Conversion en BAM avec samtools (installé localement)
sudo apt-get update -y >/dev/null
sudo apt-get install -y samtools >/dev/null
samtools view -bS toy.sam > toy.bam

# Vérification rapide du fichier BAM
samtools view toy.bam

# 5. Exécution du conteneur Docker featureCounts
docker run --rm -v $(pwd):/data featurecounts:1.4.6-p3 \
  -T 1 -t gene -g ID -s 1 \
  -a /data/annotation.gtf \
  -o /data/output_counts.txt \
  /data/toy.bam

# 6. Affichage du résultat
echo -e "\n===== Résultat du comptage ====="
cat output_counts.txt | head -n 10


#---------- Resultat a obtenir ----------------------

# Program:featureCounts v1.4.6-p3
# ...
Geneid	Chr	Start	End	Strand	Length	/data/toy.bam
geneA	chr1	1	1000	+	1000	1
geneB	chr1	2000	3000	-	1001	1

